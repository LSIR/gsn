<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
        <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
        <title>GSN</title>
        
        <link rel="stylesheet" href="style/gsn.css" type="text/css" media="screen,projection" />
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery-dom.js"></script>
        <script type="text/javascript" src="js/jquery.history.js"></script>
        <script type="text/javascript" src="js/jquery.cookie.js"></script>
        <script type="text/javascript" src="js/uptime.js"></script>

        <!-- Visualization -->
        <link rel="stylesheet" type="text/css" href="http://vizzly.ethz.ch/vizzly.min.css" />
        <link rel="stylesheet" type="text/css" href="style/jquery-ui.custom.min.css" />
        <!--[if IE]><script src="http://vizzly.ethz.ch/excanvas.js"></script><![endif]-->
        <script type='text/javascript' src='js/jquery-ui.min.js'></script>
        <script type='text/javascript' src='http://vizzly.ethz.ch/extlib/dygraph-combined.js'></script>
        <script type='text/javascript' src='http://vizzly.ethz.ch/vizzly.min.js'></script>
        <script type='text/javascript' src='js/gsnplots.js'></script>

<script type="text/javascript">
<!--//<![CDATA[

$(document).ready(function() {
    $.get('/menu.jsp', {selected: "backend"}, function(data) {
      $('#navigation').html(data);
    }, 'html');
    $("#navigation ul a.local").bind("click",function() { return GSN.nav($(this).text()); });

    // plot configuration
    GsnPlots.setConfig([
      { title:"GSN Thread Counters",
        signals: [
        { vsensor:"statistics_gsn",
          field:["thread_blocked_cnt","thread_new_cnt","thread_runnable_cnt","thread_terminated_cnt","thread_timed_waiting_cnt","thread_waiting_cnt","thread_total_cnt","thread_deadlocked_cnt"],
          timeline:"timed"}]
      },
      { title:"GSN Uptime",
        signals: [
        { vsensor:"statistics_gsn",
          field:["uptime"],
          timeline:"timed"}]
      },
      { title:"GSN Memory Usage",
        signals: [
        { vsensor:"statistics_gsn",
          field:["memory_heap_used","memory_nonheap_used"],
          timeline:"timed"}]
      },
      { title:"MySQL Operation Counters",
        signals: [
        { vsensor:"statistics_mysql",
          field:["select_cnt","insert_cnt","delete_cnt","others_cnt","fetch_cnt"],
          timeline:"timed"}]
      },
      { title:"MySQL Operation Timing",
        signals: [
        { vsensor:"statistics_mysql",
          field:["select_max","select_avg","insert_max","insert_avg","delete_max","delete_avg","others_max","others_avg","fetch_max","fetch_avg"],
          timeline:"timed"}]
      },
      { title:"Vizzly Uptime",
        signals: [
        { vsensor:"statistics_sensorviz__parsed",
          field:["uptime","requests"],
          timeline:"timed"}]
      },
      { title:"Vizzly Cache File Size",
        signals: [
        { vsensor:"statistics_sensorviz__parsed",
          field:["cache_file_size"],
          timeline:"timed"}]
      },
      { title:"Vizzly Signals/Cache Entries",
        signals: [
        { vsensor:"statistics_sensorviz__parsed",
          field:["seen_signals","cache_entries"],
          timeline:"timed"}]
      },
      { title:"Vizzly Cache Status",
          signals: [
          { vsensor:"statistics_sensorviz__parsed",
            field:["cache_requests","cache_hits","cache_misses"],
            timeline:"timed"}]
        }
    ]);
    
    $.ajax({
      type: "GET",
      url: "/gsn?structure",
      success: function(data){
        if ($(document).attr("title")=="GSN") {
          var gsn = $("gsn",data);
          $(document).attr("title",$(gsn).attr("name"));
          $("#gsn-name").empty().append($(gsn).attr("name"));
          $("#gsn-desc").empty().append($(gsn).attr("description"));
          $("#gsn-author").empty().append($(gsn).attr("author")+" ("+$(gsn).attr("email")+")");
          var gsnname = $(gsn).attr("name").replace(/.*::\s*GSN\s*-\s*/, "").replace(/\s/g,"").toLowerCase();
          $('head', document).append('<link rel="shortcut icon" href="/img/favicon/permasense-'+gsnname+'.ico"><link rel="icon" href="/img/favicon/permasense-'+gsnname+'.ico">');
        }
        $("#gsn-name").show();
        uptime.setTime($(gsn).attr("uptime"));
        GsnPlots.initPlots(data, function(){addDeployments();});
      }
    });

    var tabs = ["Adm", "Dirruhorn", "Matterhorn", "Jungfraujoch", "ETH_Infrastructure"];
    var zabbixMapIds = ["8", "9", "3", "6", "10"];
    var zabbixImgSrc = "http://carrel.ethz.ch/zabbix/map.php?sysmapid=";
    var zabbixImgSrcExt = "http://carrel.ethz.ch/zabbix/maps.php?sysmapid=";
    for (var i=0;i<tabs.length;i++) {
      $('#deployment_menu').append('<li><a href="javascript:showZabbixPlots(\''+tabs[i]+'\', \''+zabbixMapIds[i]+'\', \''+zabbixImgSrc+'\')" id="deployment_menu_item_'+tabs[i]+'">'+tabs[i]+'</a></li>');
      $('#plotscontainer').append('<div id="plot_'+tabs[i]+'"><a href="'+zabbixImgSrcExt+zabbixMapIds[i]+'" target="_blank"><img width="958px" id="img_'+tabs[i]+'" src="'+zabbixImgSrc+zabbixMapIds[i]+'"></a></div>');
      $('#plot_'+tabs[i]).hide();
    }
});

function showZabbixPlots(tab, zabbixMapId, zabbixImgSrc) {
  $('div[id^="plot_"]').hide();
  $('a[id^="deployment_menu_item_"]').removeClass("selected");
  $("#plot_"+tab).show();
  $("#deployment_menu_item_"+tab).addClass("selected");
  $.cookie("deployment" , tab);
  clearInterval(zabbixLoop);
  zabbixLoop = setInterval(function() {
    var d = new Date();
    $("#img_"+tab).attr('src', zabbixImgSrc+zabbixMapId+'&' + d.getTime());
  }, 10000);
}	

function addDeployments() {
  // add deployment tabs and container
  var visible=-1;
  var d = GsnPlots.getDeployments("Statistics");
  $(d).each(function() {
    if ($.cookie("deployment")==this)
      visible = this;
  });
  if (visible==-1) {
      visible = d[0];
  }
  $(d).each(function() {
    $('#deployment_menu').append('<li><a href="javascript:showPlots(\''+this+'\')" id="deployment_menu_item_'+this+'">'+this+'</a></li>');
    $('#plotscontainer').append('<div id="plot_'+this+'"></div>');
    $('#plot_'+this).hide();
  });
  showPlots(visible);
}

function showPlots(id) {
  $('div[id^="plot_"]').hide();
  $('a[id^="deployment_menu_item_"]').removeClass("selected");
  $(GsnPlots.getDeployments("Statistics")).each(function() {
      $("#plot_"+this).empty().hide();
      $("#deployment_menu_item_"+this).removeClass("selected");
  });
  $("#plot_"+id).show();
  $("#deployment_menu_item_"+id).addClass("selected");
  // add graphs
  GsnPlots.addPlots($("#plot_"+id), id)
  $.cookie("deployment" , id);
}	
//]]>-->
</script>
</head>
<body>

<div id="container">
	<div id="header">
		<h1><a href="." id="gsn-name" style="display:none">GSN</a></h1>
		<div id="breadcrumbnav"><a href="http://www.permasense.ch">PermaSense</a> > <a href="." id="gsn-name">GSN</a> > Backend</div>
	</div>
	<div id="navigation">
	</div>
	
	<div id="separator">
		<div id="starttext">
			<p>
				A collection of GSN backend and mysql specific plots as well as plots generated by the Zabbix monitoring server..
			</p>
		</div>
	</div>

	<div id="maindiv">
		<div id="deployment_navigation">
		<ul id="deployment_menu">
		<li />
		</ul>
		</div>	
		
		<div id="plotscontainer" style="margin-top:5px"></div>
		
	</div>
	<div class="separator">
		<div id="footer">
		      <table width="100%">
				<tr>
					<td style="width:50%;color:#444444;"><b>A Project of <a href="http://www.ethz.ch" target="_blank">ETH Zurich</a>, <a href="http://www.unibas.ch" target="_blank">Uni Basel</a> and <a href="http://www.uzh.ch" target="_blank">Uni Zurich</a></b></td>
					<td style="text-align:right;width:50%;font-size:9px;">Powered by <a href="http://gsn.sourceforge.net/">GSN</a>,  Distributed Information Systems Lab, EPFL 2006</td>
				</tr>
			</table>
		</div>
	</div>
</div>
<!-- script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5632004-2");
pageTracker._initData();
pageTracker._trackPageview();
</script -->
</body>
</html>
