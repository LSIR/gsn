<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
	<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
	<title>GSN</title>
	
	<link rel="stylesheet" href="style/gsn.css" type="text/css" media="screen,projection" />
	<script type="text/javascript" src="js/jquery.min.js"></script>
	<script type="text/javascript" src="js/jquery-dom.js"></script>
	<script type="text/javascript" src="js/jquery.history.js"></script>
	<script type="text/javascript" src="js/jquery-tooltip.js"></script>
        <script type="text/javascript" src="js/jquery.cookie.js"></script>
		
	<script type="text/javascript" src="js/constants.js"></script>
	<script type="text/javascript" src="js/functions.js"></script>
        <script type="text/javascript" src="js/uptime.js"></script>
        <!-- Visualization -->
        <link rel="stylesheet" type="text/css" href="http://vizzly.ethz.ch/vizzly.min.css" />
        <link rel="stylesheet" type="text/css" href="style/jquery-ui.custom.min.css" />
        <!--[if IE]><script src="http://vizzly.ethz.ch/excanvas.js"></script><![endif]-->
        <script type='text/javascript' src='js/jquery-ui.min.js'></script>
        <script type='text/javascript' src='http://vizzly.ethz.ch/extlib/dygraph-combined.js'></script>
        <script type='text/javascript' src='http://vizzly.ethz.ch/vizzly.min.js'></script>
        <script type='text/javascript' src='js/gsnplots.js'></script>

<script type="text/javascript">
<!--//<![CDATA[

var initialUpdateVal = 600;
var nextUpdateVal = initialUpdateVal;
var deployments = new Array();
var deployment_cameras = new Array();

function updateTopology()
{
	window.location.reload();
	/*
	var time = new Date();
	$("#healthdiv img").each(function(){
		var src = $(this).attr("src");
		$(this).attr("src",src+"?time="+time.valueOf());
		
	});*/
}

function nextUpdate()
{
	
	if(nextUpdateVal==0) nextUpdateVal=initialUpdateVal+1;
	
	nextUpdateVal=nextUpdateVal-1;
	
	$("#nextUpdate").text(nextUpdateVal);
	
	if(nextUpdateVal==0) 
	{
		updateTopology();
	}
	setTimeout("nextUpdate()",1000);
}

$(document).ready(function() {
	$.get('/menu.jsp', {selected: "weather"}, function(data) {
	  $('#navigation').html(data);
	}, 'html');
        $("#navigation ul a.local").bind("click",function() { return GSN.nav($(this).text()); });
        
        $("#nextUpdate").text(nextUpdateVal);
        setTimeout("nextUpdate()",1000);

        // plot configuration
        GsnPlots.setConfig([
          { title:"Temperature [°C]",
            signals: [ { vsensor:".*_vaisalawxt520windpth", field:["air_temperature"], select:"sensornode[position]:has(configuration[vaisala_wxt520=true])"}]
          },{ title:"Wind Speed [km/h]",
            signals: [ { vsensor:".*_vaisalawxt520windpth", field:["wind_speed_minimum","wind_speed_average","wind_speed_maximum"], select:"sensornode[position]:has(configuration[vaisala_wxt520=true])"}]
          },{ title:"Wind Direction [°]",
            signals: [ { vsensor:".*_vaisalawxt520windpth", field:["wind_direction_minimum","wind_direction_average","wind_direction_maximum"], select:"sensornode[position]:has(configuration[vaisala_wxt520=true])"}]
          },{ title:"Humidity [%RH]",
            signals: [ { vsensor:".*_vaisalawxt520windpth", field:["relative_humidity"], select:"sensornode[position]:has(configuration[vaisala_wxt520=true])"}]
          },{ title:"Air Pressure [hPa]",
            signals: [ { vsensor:".*_vaisalawxt520windpth", field:["air_pressure"], select:"sensornode[position]:has(configuration[vaisala_wxt520=true])"}]
          },{ title:"Rain [mm]",
            signals: [ { vsensor:".*_vaisalawxt520prec", field:["rain_accumulation"], select:"sensornode[position]:has(configuration[vaisala_wxt520=true])"}]
          },{ title:"Hail [hits/cm²]",
            signals: [ { vsensor:".*_vaisalawxt520prec", field:["hail_accumulation"], select:"sensornode[position]:has(configuration[vaisala_wxt520=true])"}]
          },
          { title:"Energy Balance [W/m^2]",
              signals: [ { vsensor:"matterhorn_radiometer__conv", field:["irradiance_shortwave_up","irradiance_shortwave_down","albedo","net_solar_radiation","net_radiation"], position:[15]}]
          },
          { title:"Energy Balance [W/m^2]",
              signals: [ { vsensor:"matterhorn_radiometer__conv", field:["irradiance_shortwave_up","irradiance_shortwave_down","irradiance_longwave_up","irradiance_longwave_down","net_radiation"], position:[15]}]
          },
          ]);

        // deployments
        // load deployments
        $.ajax({
              type: "GET",
              url: "/gsn?structure",
              success: function(data){
                if ($(document).attr("title")=="GSN") {
                  var gsn = $("gsn",data);
                  $(document).attr("title",$(gsn).attr("name"));
                  $("#gsn-name").empty().append($(gsn).attr("name"));
                  $("#gsn-desc").empty().append($(gsn).attr("description"));
                  $("#gsn-author").empty().append($(gsn).attr("author")+" ("+$(gsn).attr("email")+")");
                  var gsnname = $(gsn).attr("name").replace(/.*::\s*GSN\s*-\s*/, "").replace(/\s/g,"").toLowerCase();
                  $('head', document).append('<link rel="shortcut icon" href="/img/favicon/permasense-'+gsnname+'.ico"><link rel="icon" href="/img/favicon/permasense-'+gsnname+'.ico">');
                }
                $("#gsn-name").show();
                uptime.setTime($(gsn).attr("uptime"));
                var arraySize = 0;
                $("virtual-sensor",data).each(function(){
                    var deploymentname = $(this).attr("name").split("_", 1)[0];
                    if(deploymentname.length > 1) {
                        deploymentname = deploymentname.substring(0, 1).toUpperCase() + deploymentname.substring(1, deploymentname.length).toLowerCase();
                        if (deploymentname!='Statistics') {
			  if ($.inArray(deploymentname, deployments) < 0) {
                            deployments.push(deploymentname);
			    deployment_cameras.push(new Array());
			  }
			  if ($(this).attr("name").indexOf("scaled")>0) {
			    for(var i = 0; i<deployments.length;i++)
			      if (deployments[i]==deploymentname)
				break;
			    deployment_cameras[i].push($(this).attr("name"));
			  }
                        }
                    }
                });
                GsnPlots.initPlots(data, function(){addDeployments();});
              }
        });
});

function addDeployments() {
  // add deployment tabs and container
  var visible=-1;
  var d = GsnPlots.getDeployments(".*","Statistics");
  $(d).each(function() {
    if ($.cookie("deployment")==this)
      visible = this;
  });
  if (visible==-1) {
      visible = d[0];
  }
  $(d).each(function() {
    $('#deployment_menu').append('<li><a href="javascript:showPlots(\''+this+'\')" id="deployment_menu_item_'+this+'">'+this+'</a></li>');
    if ($("#weather_"+this).length == 0) {
      // add div
      $("#weathercontainer").append(
        $.DIV({
          "id":"weather_"+this
        }, 
        $.DIV({
          "class":"scaledimages nodate"
      })));
    }
    $('#weather_'+this).append('<div id="plot_'+this+'"></div>');
    $('#plot_'+this).hide();
  });
  for (i=0;i<deployment_cameras.length;i++) {
    deployment_cameras[i].sort();
    var webcam_div = $("#weather_"+deployments[i]+" .scaledimages").get(0);
    $(deployment_cameras[i]).each(function() {
      if ($(webcam_div).attr("class").indexOf("nodate")>0)
        $(webcam_div).append('<div style="float:left;position:relative;margin:2px;padding:0;width:300px;height:250px">'
                            +'<a href="field?vs='+this+'&amp;field=DATA&amp;pk=latest">'
                            +'<img src="field?vs='+this+'&amp;field=JPEG_SCALED&amp;pk=latest" width="300" height="250" alt="webcam image"></a></div>');
      else
        $(webcam_div).append('<div style="float:left;position:relative;margin:2px;padding:0;width:300px;height:250px">'
                            +'<div style="position:absolute;bottom:0px;width:171px;height:12px;background:url(field?vs='+this+'&amp;field=DATA&amp;pk=latest);background-position: -63px top;margin:0;padding:0">'
                            +'</div><a href="field?vs='+this+'&amp;field=DATA&amp;pk=latest">'
                            +'<img src="field?vs='+this+'&amp;field=JPEG_SCALED&amp;pk=latest" width="300" height="250" alt="webcam image"></a></div>');
    });
  }
  showPlots(visible);
}

function showPlots(id) {
  $(GsnPlots.getDeployments(".*","Statistics")).each(function() {
      $("#plot_"+this).empty().hide();
      $("#weather_"+this).hide();
      $("#deployment_menu_item_"+this).removeClass("selected");
  });
  $("#plot_"+id).show();
  $("#weather_"+id).show();
  $("#deployment_menu_item_"+id).addClass("selected");
  // add graphs
  GsnPlots.addPlots($("#plot_"+id), id)
  $.cookie("deployment" , id);
}       

//]]> -->
</script>
</head>
<body>

<div id="container">
	<div id="header">
		<h1><a href="." id="gsn-name" style="display:none">GSN</a></h1>
		<div id="breadcrumbnav"><a href="http://www.permasense.ch">PermaSense</a> > <a href="." id="gsn-name">GSN</a> > On-Site Weather</div>
	</div>
	<div id="navigation">
	</div>
	
	<div id="separator">
		<div id="starttext">
			<p>
				A collection of weather information related to the PermaSense Deployments.
			</p>
		</div>
	</div>
	
	
	<div id="maindiv">
                <div id="deployment_navigation">
                <ul id="deployment_menu">
		<li />
                </ul>
                </div>  
        
                <p id="updatetext">next update in <span id="nextUpdate">??</span> seconds</p>

                <div id="weathercontainer">
                
                <div id="weather_Matterhorn" style="display:none">
                <table width="100%">
                        <tr><td>
                                <b>Webcam Matterhorn</b><br/>
                                <table><tr><td><img src="http://data.permasense.ch/field?vs=matterhorn_camera_pos41_matterhornsummit__scaled&field=DATA&pk=latest" width="640" alt="Matterhorn Summit"/>
                                               <img src="http://zermatt.ch/html/bergbahnen/webcams/matterhorn2.jpg" alt="Matterhorn"/></td></tr></table>
                        </td>
                        <td valign="top">
                                <b>Weather-Info</b><br/>
                                <table><tr><td>Kleines Matterhorn</td><td>Solvay</td></tr>
                                       <tr><td><img src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/067471.png" alt="Weather Klein Matterhorn"/></td>
                                           <td><img src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/069730.png" alt="Weather Klein Matterhorn"/></td>
                                        </tr></table>
                        </td></tr>
                </table>
                <p style="text-align:center;margin-top:30px;">
                        <b>Forecast Zermatt</b><br/>
                        <img src="http://wetterstationen.meteomedia.de/messnetz/vorhersagegrafik/067480.png" alt="Weather Forecast Zermatt"/>
                </p>
                <p style="text-align:center;margin-top:30px;">
                        <b>Forecast Klein Matterhorn</b><br/>
                        <img src="http://wetterstationen.meteomedia.de/messnetz/vorhersagegrafik/067471.png" alt="Weather Forecast Klein Matterhorn"/>
                </p>
                <div> <p style="margin-top:30px;">
                        <b>PermaSense Webcams</b><br/>
                </div>
                <div class="scaledimages">
                </div>
                <div style="clear:both"></div>
                <div> <p style="margin-top:30px;">
                        <b>PermaSense Weather Station Matterhorn Hoernligrat</b><br/>
                </div>
                </div>

                <div id="weather_Jungfraujoch" style="display:none">
                <table width="100%">
                         <tr><td>
                                 <b>Webcam Jungfraujoch</b><br/>
                                <table><tr><td><img src="http://jungfrau.switch.ch/jungfraujoch/pano/Jungfraujoch_s.jpg" alt="Jungfraujoch"/>
                                               <img src="http://www.swisspanorama.com/assets/images/jungfraujoch.jpg" alt="Webcam Jungfraujoch"/>
                                               <img src="http://www.ultrasoft.ch/scheidegg/scheidegg.jpg" alt="Webcam KLeine Scheidegg"/>
                                               </td></tr></table>
                        </td>
                        <td valign="top">
                                <b>Weather-Info</b><br/>
                                <table><tr><td>Jungfraujoch</td><td>Konkordiahuette</td></tr>
                                        <tr><td><img src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/067300.png" alt="Weather Jungfraujoch"/></td>
                                            <td><img src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/069710.png" alt="Weather Konkordiah&uuml;tte"/></td>
                                        </tr></table>
                        </td></tr>
                </table>
                <p style="text-align:center;margin-top:30px;">
            			<b>Forecast Jungfraujoch</b><br/>
                        <img src="http://wetterstationen.meteomedia.de/messnetz/vorhersagegrafik/067300.png" alt="Weather Forecast Jungfraujoch"/>
                </p>
                <p style="text-align:center;margin-top:30px;">
                		<b>Forecast Lauberhorn</b><br/>
                		<img src="http://wetterstationen.meteomedia.ch/messnetz/vorhersagegrafik/067291.png" alt="Weather Forecast Lauberhorn"/>
                </p>
		<div class="scaledimages">
                </div>
                </div>

                <div id="weather_Thur" style="display:none">
                      <div style="position:relative;height:430px;width:500px;float:left">
                      <div style="position:absolute;top:0px;left:0px;z-index:2">
                        <a href="http://www.hochwasser.zh.ch/internet/bd/awel/wb/hw/de/messwerte/abfluss_wasserstand/thur.html"><img src="http://www.hw.zh.ch/hochwasser/mac/aawthur_map.gif" width="500" height="405" alt="Water level Thur"/></a>
                      </div>
                      <div style="position:absolute;top:0px;left:0px;z-index:1">
                        <img src="http://www.hw.zh.ch/hochwasser/mac/aawthur.gif" width="500" height="405" alt="Water level Thur"/>
                      </div>
                      </div>
		      <div style="margin-left:540px;height:430px" class="scaledimages nodate">
		      </div>
               </div>

               <div id="weather_AdM" style="display:none">

                <table width="100%">
                <tr><td><img src="http://www.compagniedumontblanc.fr/webcam/Tam3helbronner.jpg" alt="Weather Cham"/></td>
                    <td><img src="http://www.compagniedumontblanc.fr/webcam/tam_arrete.jpg" alt="Weather Cham"/></td>
                    <td><img src="http://www.compagniedumontblanc.fr/webcam/Aiguille.jpg" alt="Weather Cham"/></td>
                    <td><img src="http://www.compagniedumontblanc.fr/webcam/tam2vuemontblanc.jpg" alt="Weather Cham"/></td>
                </tr></table>

               </div>

                <div id="weather_Dirruhorn" style="display:none">
                <table width="100%">
                     <tr><td>
                             <b>Heliport Air Zermatt</b><br/>
                             <table><tr><td><a href="http://www.air-zermatt.ch/webcam/Heliport.jpg"><img style="margin-top:21px" src="http://www.air-zermatt.ch/webcam/Heliport.jpg" width="400" height="327" alt="Webcam Zermatt direction north"/></a></td></tr></table>
                         </td>
                         <td valign="top">
                                 <b>Weather-Info</b><br/>
                         <table><tr><td>Randa</td><td>Zermatt</td><td>Gornergrat</td></tr>
                         <tr><td><img style="margin-top:10px" src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/069141.png" alt="Weather Randa"/></td>
                             <td><img style="margin-top:10px" src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/067480.png" alt="Weather Zermatt"/></td>
                             <td><img style="margin-top:10px" src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/067490.png" alt="Weather Gornergrat"/></td>
                         </tr></table>
                     </td></tr>
                </table> 
                <p style="text-align:center;margin-top:30px;">
                        <b>Forecast Randa</b><br/>
                        <img src="http://wetterstationen.meteomedia.de/messnetz/vorhersagegrafik/069141.png" alt="Weather Forecast Randa"/>
                </p>
                <div> <p style="margin-top:30px;">
                        <b>PermaSense/UniFR Webcams</b><br/>
                </div>
                <div class="scaledimages">
                </div><div style="clear:both"></div>
                <div> <p style="margin-top:30px;">
                        <b>PermaSense Weather Station Dirruhorn Gruengarten (Position 13) & Grabengufer (Position 42) & Breithorn Bielzug (Position 68)</b><br/> 
                </div>
                </div>

                <div id="weather_Saastal" style="display:none">
                <table width="100%">
                     <tr><td>
                             <b>Hohsaas</b><br/>
                             <table><tr><td><a href="http://www.hohsaas.info/livebild/hohsaas_fullsize.jpg"><img style="margin-top:21px" src="http://www.hohsaas.info/livebild/hohsaas_fullsize.jpg" width="400" height="327" alt="Webcam Hohsaas"/></a></td></tr></table>
                         </td>
                         <td valign="top">
                                 <b>Weather-Info</b><br/>
                         <table><tr><td>Saas Fee</td><td>Mittelallalin</td></tr>
                         <tr><td><img style="margin-top:10px" src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/069266.png" alt="Weather Saas Fee"/></td>
                             <td><img style="margin-top:10px" src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/069377.png" alt="Weather Mittelallalin"/></td>
                         </tr></table>
                     </td></tr>
                </table> 
                <p style="text-align:center;margin-top:30px;">
                        <b>Forecast Saas Fee</b><br/>
                        <img src="http://wetterstationen.meteomedia.de/messnetz/vorhersagegrafik/069266.png" alt="Weather Forecast Saas Fee"/>
                </p>
                <div> <p style="margin-top:30px;">
                        <b>PermaSense CamZilla</b><br/>
                </div>
                <div class="scaledimages">
                </div>
                </div>

                <div id="weather_Glaciers" style="display:none">
                <table style="margin-left:85px">
                     <tr><td>Rhone Glacier Upper Part</td><td>Weather-Info Grimselpass</td><td>Rhone Glacier Lower Part</td></tr>
                     <tr>
                         <td><div style="margin-top:21px" class="scaledimages nodate"></td>
                         <td><img style="margin-top:10px" src="http://wetterstationen.meteomedia.de/messnetz/wettergrafik/067440.png" alt="Weather Grimselpass"/></td>
                         <td><a href="http://people.ee.ethz.ch/~glacier/images/rhone_acam.jpg"><img style="margin-top:21px" src="http://people.ee.ethz.ch/~glacier/images/rhone_acam.jpg" width="306" height="250" alt="Camera Rhone Glacier Lower Part"/></a></td>
                     </tr>
                </table>
                <p style="text-align:center;margin-top:30px;">
                        <b>Forecast Grimselpass</b><br/><br/>
                        <img src="http://wetterstationen.meteomedia.de/messnetz/vorhersagegrafik/067440.png" alt="Weather forecast Grimselpass"/>
                </p>
                </div>

                </div>

		<br/>

		<p style="text-align:center;margin-top:30px;">
			<b>Current Satellite Image</b><br/>
			<img src="http://files.newsnetz.ch/wetter/satellite/m_sat_05.jpg" alt="Satellite Image"/>
		</p>
                <p style="text-align:center;margin-top:30px;">
                        <b>Current Jetstream</b><br/>
                        <img src="http://www.wetterzentrale.de/pics/Rtavn0015.gif"/>
                </p>
	</div>
	<div class="separator">
		<div id="footer">
		      <table width="100%">
				<tr>
					<td style="width:50%;color:#444444;"><b>A Project of <a href="http://www.ethz.ch" target="_blank">ETH Zurich</a>, <a href="http://www.unibas.ch" target="_blank">Uni Basel</a> and <a href="http://www.uzh.ch" target="_blank">Uni Zurich</a></b></td>
					<td style="text-align:right;width:50%;font-size:9px;">Powered by <a href="http://gsn.sourceforge.net/">GSN</a>,  Distributed Information Systems Lab, EPFL 2006</td>
				</tr>
			</table>
		</div>
	</div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">
var pageTracker = _gat._getTracker("UA-5632004-2");
pageTracker._initData();
pageTracker._trackPageview();
</script>
</body>
</html>
